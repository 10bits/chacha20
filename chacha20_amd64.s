// Generated by PeachPy 0.2.0 from chacha20_amd64.py


// func blocksAmd64SSE2(x *uint32, inp *uint8, outp *uint8, nrBlocks *uint)
TEXT Â·blocksAmd64SSE2(SB),4,$0-32
	MOVQ x+0(FP), AX
	MOVQ inp+8(FP), BX
	MOVQ outp+16(FP), CX
	MOVQ nrBlocks+24(FP), DX
	MOVQ SP, DI
	ANDQ $15, DI
	MOVQ $16, SI
	SUBQ DI, SI
	SUBQ SI, SP
	SUBQ $16, SP
	MOVL $1, DI
	MOVL DI, 0(SP)
	MOVL $0, DI
	MOVL DI, 4(SP)
	MOVL DI, 8(SP)
	MOVL DI, 12(SP)
	MOVO 16(AX), X1
	MOVO 32(AX), X2
	MOVO 48(AX), X3
	SUBQ $3, DX
	JCS vector_loop_end
vector_loop_begin:
		MOVO 0(AX), X4
		MOVO X1, X5
		MOVO X2, X6
		MOVO X3, X7
		MOVO 0(AX), X8
		MOVO X1, X9
		MOVO X2, X10
		MOVO X3, X11
		PADDQ 0(SP), X11
		MOVO 0(AX), X12
		MOVO X1, X13
		MOVO X2, X14
		MOVO X11, X15
		PADDQ 0(SP), X15
		MOVQ $20, DI
rounds_loop0_begin:
			PADDL X5, X4
			PXOR X4, X7
			MOVO X7, X0
			PSLLL $16, X0
			PSRLL $16, X7
			PXOR X0, X7
			PADDL X7, X6
			PXOR X6, X5
			MOVO X5, X0
			PSLLL $12, X0
			PSRLL $20, X5
			PXOR X0, X5
			PADDL X5, X4
			PXOR X4, X7
			MOVO X7, X0
			PSLLL $8, X0
			PSRLL $24, X7
			PXOR X0, X7
			PADDL X7, X6
			PXOR X6, X5
			MOVO X5, X0
			PSLLL $7, X0
			PSRLL $25, X5
			PXOR X0, X5
			PSHUFL $57, X5, X5
			PSHUFL $78, X6, X6
			PSHUFL $147, X7, X7
			PADDL X5, X4
			PXOR X4, X7
			MOVO X7, X0
			PSLLL $16, X0
			PSRLL $16, X7
			PXOR X0, X7
			PADDL X7, X6
			PXOR X6, X5
			MOVO X5, X0
			PSLLL $12, X0
			PSRLL $20, X5
			PXOR X0, X5
			PADDL X5, X4
			PXOR X4, X7
			MOVO X7, X0
			PSLLL $8, X0
			PSRLL $24, X7
			PXOR X0, X7
			PADDL X7, X6
			PXOR X6, X5
			MOVO X5, X0
			PSLLL $7, X0
			PSRLL $25, X5
			PXOR X0, X5
			PSHUFL $147, X5, X5
			PSHUFL $78, X6, X6
			PSHUFL $57, X7, X7
			PADDL X9, X8
			PXOR X8, X11
			MOVO X11, X0
			PSLLL $16, X0
			PSRLL $16, X11
			PXOR X0, X11
			PADDL X11, X10
			PXOR X10, X9
			MOVO X9, X0
			PSLLL $12, X0
			PSRLL $20, X9
			PXOR X0, X9
			PADDL X9, X8
			PXOR X8, X11
			MOVO X11, X0
			PSLLL $8, X0
			PSRLL $24, X11
			PXOR X0, X11
			PADDL X11, X10
			PXOR X10, X9
			MOVO X9, X0
			PSLLL $7, X0
			PSRLL $25, X9
			PXOR X0, X9
			PSHUFL $57, X9, X9
			PSHUFL $78, X10, X10
			PSHUFL $147, X11, X11
			PADDL X9, X8
			PXOR X8, X11
			MOVO X11, X0
			PSLLL $16, X0
			PSRLL $16, X11
			PXOR X0, X11
			PADDL X11, X10
			PXOR X10, X9
			MOVO X9, X0
			PSLLL $12, X0
			PSRLL $20, X9
			PXOR X0, X9
			PADDL X9, X8
			PXOR X8, X11
			MOVO X11, X0
			PSLLL $8, X0
			PSRLL $24, X11
			PXOR X0, X11
			PADDL X11, X10
			PXOR X10, X9
			MOVO X9, X0
			PSLLL $7, X0
			PSRLL $25, X9
			PXOR X0, X9
			PSHUFL $147, X9, X9
			PSHUFL $78, X10, X10
			PSHUFL $57, X11, X11
			PADDL X13, X12
			PXOR X12, X15
			MOVO X15, X0
			PSLLL $16, X0
			PSRLL $16, X15
			PXOR X0, X15
			PADDL X15, X14
			PXOR X14, X13
			MOVO X13, X0
			PSLLL $12, X0
			PSRLL $20, X13
			PXOR X0, X13
			PADDL X13, X12
			PXOR X12, X15
			MOVO X15, X0
			PSLLL $8, X0
			PSRLL $24, X15
			PXOR X0, X15
			PADDL X15, X14
			PXOR X14, X13
			MOVO X13, X0
			PSLLL $7, X0
			PSRLL $25, X13
			PXOR X0, X13
			PSHUFL $57, X13, X13
			PSHUFL $78, X14, X14
			PSHUFL $147, X15, X15
			PADDL X13, X12
			PXOR X12, X15
			MOVO X15, X0
			PSLLL $16, X0
			PSRLL $16, X15
			PXOR X0, X15
			PADDL X15, X14
			PXOR X14, X13
			MOVO X13, X0
			PSLLL $12, X0
			PSRLL $20, X13
			PXOR X0, X13
			PADDL X13, X12
			PXOR X12, X15
			MOVO X15, X0
			PSLLL $8, X0
			PSRLL $24, X15
			PXOR X0, X15
			PADDL X15, X14
			PXOR X14, X13
			MOVO X13, X0
			PSLLL $7, X0
			PSRLL $25, X13
			PXOR X0, X13
			PSHUFL $147, X13, X13
			PSHUFL $78, X14, X14
			PSHUFL $57, X15, X15
			SUBQ $2, DI
			JNE rounds_loop0_begin
		PADDL 0(AX), X4
		PADDL X1, X5
		PADDL X2, X6
		PADDL X3, X7
		MOVOU 0(BX), X0
		PXOR X4, X0
		MOVOU X0, 0(CX)
		MOVOU 16(BX), X0
		PXOR X5, X0
		MOVOU X0, 16(CX)
		MOVOU 32(BX), X0
		PXOR X6, X0
		MOVOU X0, 32(CX)
		MOVOU 48(BX), X0
		PXOR X7, X0
		MOVOU X0, 48(CX)
		PADDQ 0(SP), X3
		PADDL 0(AX), X8
		PADDL X1, X9
		PADDL X2, X10
		PADDL X3, X11
		MOVOU 64(BX), X0
		PXOR X8, X0
		MOVOU X0, 64(CX)
		MOVOU 80(BX), X0
		PXOR X9, X0
		MOVOU X0, 80(CX)
		MOVOU 96(BX), X0
		PXOR X10, X0
		MOVOU X0, 96(CX)
		MOVOU 112(BX), X0
		PXOR X11, X0
		MOVOU X0, 112(CX)
		PADDQ 0(SP), X3
		PADDL 0(AX), X12
		PADDL X1, X13
		PADDL X2, X14
		PADDL X3, X15
		MOVOU 128(BX), X0
		PXOR X12, X0
		MOVOU X0, 128(CX)
		MOVOU 144(BX), X0
		PXOR X13, X0
		MOVOU X0, 144(CX)
		MOVOU 160(BX), X0
		PXOR X14, X0
		MOVOU X0, 160(CX)
		MOVOU 176(BX), X0
		PXOR X15, X0
		MOVOU X0, 176(CX)
		PADDQ 0(SP), X3
		ADDQ $192, BX
		ADDQ $192, CX
		SUBQ $3, DX
		JCC vector_loop_begin
vector_loop_end:
	ADDQ $3, DX
	JEQ serial_loop_end
	MOVO 0(AX), X8
	MOVO 0(SP), X9
serial_loop_begin:
		MOVO X8, X4
		MOVO X1, X5
		MOVO X2, X6
		MOVO X3, X7
		MOVQ $20, DI
rounds_loop1_begin:
			PADDL X5, X4
			PXOR X4, X7
			MOVO X7, X0
			PSLLL $16, X0
			PSRLL $16, X7
			PXOR X0, X7
			PADDL X7, X6
			PXOR X6, X5
			MOVO X5, X0
			PSLLL $12, X0
			PSRLL $20, X5
			PXOR X0, X5
			PADDL X5, X4
			PXOR X4, X7
			MOVO X7, X0
			PSLLL $8, X0
			PSRLL $24, X7
			PXOR X0, X7
			PADDL X7, X6
			PXOR X6, X5
			MOVO X5, X0
			PSLLL $7, X0
			PSRLL $25, X5
			PXOR X0, X5
			PSHUFL $57, X5, X5
			PSHUFL $78, X6, X6
			PSHUFL $147, X7, X7
			PADDL X5, X4
			PXOR X4, X7
			MOVO X7, X0
			PSLLL $16, X0
			PSRLL $16, X7
			PXOR X0, X7
			PADDL X7, X6
			PXOR X6, X5
			MOVO X5, X0
			PSLLL $12, X0
			PSRLL $20, X5
			PXOR X0, X5
			PADDL X5, X4
			PXOR X4, X7
			MOVO X7, X0
			PSLLL $8, X0
			PSRLL $24, X7
			PXOR X0, X7
			PADDL X7, X6
			PXOR X6, X5
			MOVO X5, X0
			PSLLL $7, X0
			PSRLL $25, X5
			PXOR X0, X5
			PSHUFL $147, X5, X5
			PSHUFL $78, X6, X6
			PSHUFL $57, X7, X7
			SUBQ $2, DI
			JNE rounds_loop1_begin
		PADDL X8, X4
		PADDL X1, X5
		PADDL X2, X6
		PADDL X3, X7
		MOVOU 0(BX), X0
		PXOR X4, X0
		MOVOU X0, 0(CX)
		MOVOU 16(BX), X0
		PXOR X5, X0
		MOVOU X0, 16(CX)
		MOVOU 32(BX), X0
		PXOR X6, X0
		MOVOU X0, 32(CX)
		MOVOU 48(BX), X0
		PXOR X7, X0
		MOVOU X0, 48(CX)
		PADDQ X9, X3
		ADDQ $64, BX
		ADDQ $64, CX
		SUBQ $1, DX
		JNE serial_loop_begin
serial_loop_end:
	MOVO X3, 48(AX)
	ADDQ $16, SP
	ADDQ SI, SP
	RET
